LDI RegA $0 ; INICIO DO SETUP
STA RegA HEX0
STA RegA HEX1
STA RegA HEX2
STA RegA HEX3
STA RegA HEX4
STA RegA HEX5
STA RegA LEDR0-7
STA RegA LEDR8
STA RegA LEDR9
STA RegA @0 ;UNIDADR
STA RegA @1 ;DEZENA
STA RegA @2 ;CENTENA
STA RegA @3 ;MILHAR
STA RegA @4 ;DEZENA DE MILHAR
STA RegA @5 ;CENTENA DE MILHAR
STA RegA @6 ; VALOR 0
STA RegA CLR-KEY0
STA RegA CLR-KEY1
LDI RegA $1
STA RegA @14 ; VALOR 1

LDI RegA $10
STA RegA @15 ; VALOR 10

LDI RegA $0
STA RegA @16 ;LIMITE DE CONTAGEM

LDI RegA $20
STA RegA @8 ;LIMITE PARA UNIDADE
STA RegA @9 ;LIMITE PARA DEZENA
STA RegA @10 ;LIMITE PARA CENTENA
STA RegA @11 ;LIMITE PARA MILHAR
STA RegA @12 ;LIMITE PARA DEZENA DE MILHAR
STA RegA @13 ;LIMITE PARA CENTENA DE MILHAR
FIM-DO-SETUP

MAIN

JSR ESCREVE-HEX

LDA RegA KEY1
ANDOP @14
CEQ RegA @6 
JEQ PASS-CONFIG
JSR CONFIG-LIMITE
PASS-CONFIG

JSR LIMITE-DE-CONTAGEM

LDA RegA KEY0
ANDOP @14
CEQ RegA @6
JEQ PASS-INCREMENTA
JSR INCREMENTA-VALOR
PASS-INCREMENTA

LDA RegA FPGA_RESET
ANDOP @14
CEQ RegA @6
JEQ PASS-RENICIAR
JSR RENICIAR-CONT
PASS-RENICIAR

JMP MAIN


ESCREVE-HEX 
LDA RegC @0
STA RegC HEX0
NOP
LDA RegC @1
STA RegC HEX1
NOP
LDA RegC @2
STA RegC HEX2
NOP
LDA RegC @3
STA RegC HEX3
NOP
LDA RegC @4
STA RegC HEX4
NOP
LDA RegC @5
STA RegC HEX5
RET


INCREMENTA-VALOR
STA RegA CLR-KEY0
LDA RegA @16
CEQ RegA @14 
JEQ VOLTA-VALOR ;VERIFICA SE O LIMIETE DE CONTAGEM FOI ATINGIDO

LDA RegA @0  ; UNIDADE
SOMA RegA @14 ; A+1
STA RegA @0 ; UNIDADE
CEQ RegA @15 ; A == 10
JEQ INC-DEZENA
NOP
RET

INC-DEZENA
LDI RegA $0
STA RegA @0 ;ZERA UNIDADE
LDA RegA @1 ;DEZENA
SOMA RegA @14 ; A+1
STA RegA @1
CEQ RegA @15 ; A == 10
JEQ INC-CENTENA
NOP
RET

INC-CENTENA
LDI RegA $0
STA RegA @1 ; ZERA DEZENA
LDA RegA @2 ; CENTENA
SOMA RegA @14 ; A+1
STA RegA @2
CEQ RegA @15 ; A == 10
JEQ INC-UNIDADE-MILHAR
NOP
RET

INC-UNIDADE-MILHAR
LDI RegA $0
STA RegA @2
LDA RegA @3
SOMA RegA @14
STA RegA @3
CEQ RegA @15
JEQ INC-DEZENA-MILHAR
NOP
RET

INC-DEZENA-MILHAR
LDI RegA $0
STA RegA @3
LDA RegA @4
SOMA RegA @14
STA RegA @4
CEQ RegA @15
JEQ INC-CENTENA-MILHAR
NOP
RET

INC-CENTENA-MILHAR
LDI RegA $0
STA RegA @4
LDA RegA @5
SOMA RegA @14
STA RegA @5
CEQ RegA @15
JEQ ZERO
NOP
RET

ZERO
LDI RegA $0
STA RegA @2

LDI RegA $1
STA RegA LEDR9 ;LED OVERFLOW
STA RegA @16


VOLTA-VALOR
RET


CONFIG-LIMITE
STA RegA CLR-KEY1

LDI RegA $1
STA RegA LEDR8
STA RegA LEDR9

DEFINE-UNIDADE
LDI RegA $1
STA RegA LEDR0-7
LDA RegA SW0_7
STA RegA @8

LDA RegA KEY1 ;ESPERA CONFIRMAÇÃO DA RESPOSTA RegAS
ANDOP @14
CEQ RegA @6
JEQ DEFINE-UNIDADE

LDI RegA $0 ;APAGA LED0
STA RegA LEDR0-7
STA RegA CLR-KEY1

DEFINE-DEZENA
LDI RegA $2
STA RegA LEDR0-7
LDA RegA SW0_7
STA RegA @9

LDA RegA KEY1 ;ESPERA CONFIRMAÇÃO DA RESPOSTA RegAS
ANDOP @14
CEQ RegA @6
JEQ DEFINE-DEZENA

LDI RegA $0 ;APAGA LED1
STA RegA LEDR0-7
STA RegA CLR-KEY1

DEFINE-CENTENA
LDI RegA $4
STA RegA LEDR0-7
LDA RegA SW0_7
STA RegA @10

LDA RegA KEY1
ANDOP @14
CEQ RegA @6
JEQ DEFINE-CENTENA

LDI RegA $0
STA RegA LEDR0-7
STA RegA CLR-KEY1

DEFINE-UNIDADE-MILHAR
LDI RegA $8
STA RegA LEDR0-7
LDA RegA SW0_7
STA RegA @11

LDA RegA KEY1
ANDOP @14
CEQ RegA @6
JEQ DEFINE-UNIDADE-MILHAR

LDI RegA $0
STA RegA LEDR0-7
STA RegA CLR-KEY1

DEFINE-DEZENA-MILHAR
LDI RegA $16
STA RegA LEDR0-7
LDA RegA SW0_7
STA RegA @12

LDA RegA KEY1
ANDOP @14
CEQ RegA @6
JEQ DEFINE-DEZENA-MILHAR

LDI RegA $0
STA RegA LEDR0-7
STA RegA CLR-KEY1

DEFINE-CENTENA-MILHAR
LDI RegA $32
STA RegA LEDR0-7
LDA RegA SW0_7
STA RegA @13

LDA RegA KEY1
ANDOP @14
CEQ RegA @6
JEQ DEFINE-CENTENA-MILHAR

LDI RegA $0
STA RegA LEDR0-7
STA RegA CLR-KEY1

STA RegA LEDR8
STA RegA LEDR9
JMP MAIN

LIMITE-DE-CONTAGEM

LDA RegB @5
CEQ RegB @13
JEQ PROX--DEZENA-MILHAR
LDI RegB $0
STA RegB @16 ;ABAIXA FLAG DE LIMITE DE CONTAGEM
RET

PROX--DEZENA-MILHAR
LDA RegB @4
CEQ RegB @12
JEQ PROX--UNIDADE-MILHAR
LDI RegB $0
STA RegB @16 ;ABAIXA FLAG DE LIMITE DE CONTAGEM
RET

PROX--UNIDADE-MILHAR
LDA RegB @3
CEQ RegB @11
JEQ PROX--CENTENA
LDI RegB $0
STA RegB @16 ;ABAIXA FLAG DE LIMITE DE CONTAGEM
RET

PROX--CENTENA
LDA RegB @2
CEQ RegB @10
JEQ PROX--DEZENA
LDI RegB $0
STA RegB @16 ;ABAIXA FLAG DE LIMITE DE CONTAGEM
RET

PROX--DEZENA
LDA RegB @1
CEQ RegB @9
JEQ PROX--UNIDADE
LDI RegB $0
STA RegB @16 ;ABAIXA FLAG DE LIMITE DE CONTAGEM
RET

PROX--UNIDADE
LDA RegB @0
CEQ RegB @8
JEQ PROX--NADA
LDI RegB $0
STA RegB @16 ;ABAIXA FLAG DE LIMITE DE CONTAGEM
RET

PROX--NADA
LDI RegB $1
STA RegB @16
STA RegB LEDR8
RET

RENICIAR-CONT
STA RegA CLR-FPGA-RESET
LDI RegA $0
STA RegA @0
STA RegA @1
STA RegA @2
STA RegA @3
STA RegA @4
STA RegA @5
STA RegA @16
STA RegA LEDR8
STA RegA LEDR9
STA RegA LEDR0-7

RET