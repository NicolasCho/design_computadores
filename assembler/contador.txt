LDI RegA $0 ; INICIO DO SETUP
STA RegA HEX0 ;SETE SEGMENTOS MAIS DIREITA
STA RegA HEX1
STA RegA HEX2
STA RegA HEX3
STA RegA HEX4
STA RegA HEX5 ;SETE SEGMENTOS MAIS A ESQUERDA
STA RegA LEDR0-7
STA RegA LEDR8
STA RegA LEDR9
STA RegA @0 ;UNIDADR
STA RegA @1 ;DEZENA
STA RegA @2 ;CENTENA
STA RegA @3 ;MILHAR
STA RegA @4 ;DEZENA DE MILHAR
STA RegA @5 ;CENTENA DE MILHAR
STA RegA @6 ; VALOR 0
STA RegA CLR-KEY0
STA RegA CLR-KEY1
LDI RegA $1
STA RegA @14 ; VALOR 1

LDI RegA $10
STA RegA @15 ; VALOR 10

LDI RegA $0
STA RegA @16 ;FLAG MAXIMO

STA RegA @8 ;LIMITE PARA UNIDADE
STA RegA @9 ;LIMITE PARA DEZENA
STA RegA @10 ;LIMITE PARA CENTENA
STA RegA @11 ;LIMITE PARA MILHAR
STA RegA @12 ;LIMITE PARA DEZENA DE MILHAR
STA RegA @13 ;LIMITE PARA CENTENA DE MILHAR
FIM-DO-SETUP

MAIN

JSR ESCREVE-HEX

JSR LIMITE-DE-CONTAGEM

LDA RegA KEY0
ANDOP @14 ; limpa o sinal da key0
CEQ RegA @6 ; A == 0
JEQ PASS-INCREMENTA
JSR INCREMENTA-VALOR
PASS-INCREMENTA

LDA RegA KEY1
ANDOP @14 ; limpa o sinal da key1
CEQ RegA @6 ; A == 0
JEQ PASS-CONFIG
JSR CONFIG-LIMITE
PASS-CONFIG

LDA RegA FPGA_RESET
ANDOP @14 ; limpa o sinal da FPGA_RESET
CEQ RegA @6 ; A == 0
JEQ PASS-RENICIAR
JSR RENICIAR-CONT
PASS-RENICIAR

JMP MAIN


ESCREVE-HEX 
LDA RegC @0 ;UNIDADE
STA RegC HEX0
NOP
LDA RegC @1 ;DEZENA
STA RegC HEX1
NOP
LDA RegC @2 ;CENTENA
STA RegC HEX2
NOP
LDA RegC @3 ;UNIDADE DE MILHAR
STA RegC HEX3
NOP
LDA RegC @4 ;DEZENA DE MILHAR
STA RegC HEX4
NOP
LDA RegC @5;CENTENA DE MILHAR
STA RegC HEX5
RET


INCREMENTA-VALOR
STA RegA CLR-KEY0
LDA RegA @16 
CEQ RegA @14 ; verifica se flag para impedir o incremento está 1
JEQ VOLTA-VALOR

LDA RegA @0  ; UNIDADE
SOMA RegA @14 ; A+1
STA RegA @0 ; UNIDADE
CEQ RegA @15 ; A == 10
JEQ INC-DEZENA
NOP
RET

INC-DEZENA
LDI RegA $0
STA RegA @0 ;ZERA UNIDADE
LDA RegA @1 ;DEZENA
SOMA RegA @14 ; A+1
STA RegA @1
CEQ RegA @15 ; A == 10
JEQ INC-CENTENA
NOP
RET

INC-CENTENA
LDI RegA $0
STA RegA @1 ; ZERA DEZENA
LDA RegA @2 ; CENTENA
SOMA RegA @14 ; A+1
STA RegA @2
CEQ RegA @15 ; A == 10
JEQ INC-UNIDADE-MILHAR
NOP
RET

INC-UNIDADE-MILHAR
LDI RegA $0
STA RegA @2 ;ZERA CENTENA
LDA RegA @3 ;UNIDADE DE MILHAR
SOMA RegA @14 ; A+1
STA RegA @3
CEQ RegA @15 ; A == 10
JEQ INC-DEZENA-MILHAR
NOP
RET

INC-DEZENA-MILHAR
LDI RegA $0
STA RegA @3 ; ZERA UNIDADE DE MILHAR
LDA RegA @4 ; DEZENA DE MILHAR
SOMA RegA @14 ; A+1
STA RegA @4
CEQ RegA @15 ; A == 10
JEQ INC-CENTENA-MILHAR
NOP
RET

INC-CENTENA-MILHAR
LDI RegA $0
STA RegA @4 ; ZERA DEZENA DE MILHAR
LDA RegA @5 ; CENTENA DE MILHAR
SOMA RegA @14 ; A+1
STA RegA @5 
CEQ RegA @15 ; A == 10
JEQ ZERO
NOP
RET

ZERO
LDI RegA $0
STA RegA @5 ;ZERA CENTENA DE MILHAR

LDI RegA $1
STA RegA LEDR9 ;LED OVERFLOW
STA RegA @16 ; SOBE A FLAG DE OVERFLOW


VOLTA-VALOR
RET


CONFIG-LIMITE
STA RegA CLR-KEY1 

LDI RegA $1
STA RegA LEDR8
STA RegA LEDR9 ; ACENDE LEDS 8 E 9 PARA INDICAR O MODO DE CONFIG. ATIVO

DEFINE-UNIDADE
LDI RegA $1
STA RegA LEDR0-7 ; ACENDE O LED0 PARA INDICAR O CAMPO DA UNIDADE
LDA RegA SW0_7
STA RegA @8

LDA RegA KEY1 ;ESPERA CONFIRMAÇÃO DA RESPOSTA 
ANDOP @14
CEQ RegA @6
JEQ DEFINE-UNIDADE

LDI RegA $0 ;APAGA LED0
STA RegA LEDR0-7
STA RegA CLR-KEY1

DEFINE-DEZENA
LDI RegA $2 
STA RegA LEDR0-7 ; ACENDE O LED1 PARA INDICAR O CAMPO DA DEZENA 
LDA RegA SW0_7
STA RegA @9

LDA RegA KEY1 ;ESPERA CONFIRMAÇÃO DA RESPOSTA
ANDOP @14
CEQ RegA @6
JEQ DEFINE-DEZENA

LDI RegA $0 ;APAGA LED1
STA RegA LEDR0-7
STA RegA CLR-KEY1

DEFINE-CENTENA
LDI RegA $4
STA RegA LEDR0-7 ; ACENDE O LED2 PARA INDICAR O CAMPO DA CENTENA
STA RegA @10

LDA RegA KEY1 ;ESPERA CONFIRMAÇÃO DA RESPOSTA
ANDOP @14
CEQ RegA @6
JEQ DEFINE-CENTENA

LDI RegA $0 ;APAGA LED2
STA RegA LEDR0-7
STA RegA CLR-KEY1

DEFINE-UNIDADE-MILHAR
LDI RegA $8
STA RegA LEDR0-7 ; ACENDE O LED3 PARA INDICAR O CAMPO DA UNIDADE DE MILHAR
LDA RegA SW0_7
STA RegA @11

LDA RegA KEY1 ;ESPERA CONFIRMAÇÃO DA RESPOSTA
ANDOP @14
CEQ RegA @6
JEQ DEFINE-UNIDADE-MILHAR

LDI RegA $0 ;APAGA LED3
STA RegA LEDR0-7
STA RegA CLR-KEY1

DEFINE-DEZENA-MILHAR
LDI RegA $16
STA RegA LEDR0-7 ; ACENDE O LED4 PARA INDICAR O CAMPO DA DEZENA DE MILHAR
LDA RegA SW0_7
STA RegA @12

LDA RegA KEY1 ;ESPERA CONFIRMAÇÃO DA RESPOSTA
ANDOP @14
CEQ RegA @6
JEQ DEFINE-DEZENA-MILHAR

LDI RegA $0 ;APAGA LED4
STA RegA LEDR0-7
STA RegA CLR-KEY1

DEFINE-CENTENA-MILHAR
LDI RegA $32
STA RegA LEDR0-7 ; ACENDE O LED5 PARA INDICAR O CAMPO DA DEZENA DE MILHAR
LDA RegA SW0_7
STA RegA @13

LDA RegA KEY1 ;ESPERA CONFIRMAÇÃO DA RESPOSTA
ANDOP @14
CEQ RegA @6
JEQ DEFINE-CENTENA-MILHAR

LDI RegA $0 ;APAGA LED5
STA RegA LEDR0-7
STA RegA CLR-KEY1

STA RegA LEDR8
STA RegA LEDR9 ;APAGA OS LEDS 8 E 9 INDICANDO A SAIDA DO MODO DE CONFIG.
JMP MAIN

LIMITE-DE-CONTAGEM

LDA RegB @5
CEQ RegB @13 ;VERIFICA LIMITE DE CONTAGEM PARA CENTENA DE MILHAR
JEQ PROX--DEZENA-MILHAR
RET

PROX--DEZENA-MILHAR
LDA RegB @4
CEQ RegB @12 ;VERIFICA LIMITE DE CONTAGEM PARA DEZENA DE MILHAR
JEQ PROX--UNIDADE-MILHAR
RET

PROX--UNIDADE-MILHAR
LDA RegB @3
CEQ RegB @11 ;VERIFICA LIMITE DE CONTAGEM PARA UNIDADE DE MILHAR
JEQ PROX--CENTENA
RET

PROX--CENTENA
LDA RegB @2
CEQ RegB @10 ;VERIFICA LIMITE DE CONTAGEM PARA CENTENA
JEQ PROX--DEZENA
RET

PROX--DEZENA
LDA RegB @1
CEQ RegB @9 ;VERIFICA LIMITE DE CONTAGEM PARA DEZENA
JEQ PROX--UNIDADE
RET

PROX--UNIDADE
LDA RegB @0
CEQ RegB @8 ;VERIFICA LIMITE DE CONTAGEM PARA UNIDADE
JEQ PROX--NADA
RET

PROX--NADA
LDI RegB $1
STA RegB @16 ;SOBE A FLAG DE IMPEDIR INCREMENTO
STA RegB LEDR8 ;ACENDE O LED8 INDICANDO QUE CHEGOU AO LIMITE DE CONTAGEM
RET

RENICIAR-CONT
STA RegA CLR-FPGA-RESET
LDI RegA $0 
STA RegA @0 ;ZERA UNIDADE
STA RegA @1 ;ZERA DEZENA
STA RegA @2 ;ZERA CENTENA
STA RegA @3 ;ZERA UNIDADE DE MILHAR
STA RegA @4 ;ZERA DEZENA DE MILHAR
STA RegA @5 ;ZERA CENTENA DE MILHAR
STA RegA @16 ;ABAIXA A FLAG DE IMPDIR INCREMENTO
STA RegA LEDR8 ;APAGA O LED8
STA RegA LEDR9 ;APAGA O LED9
STA RegA LEDR0-7 ;APAGA OS LEDS DE 0 A 7

RET