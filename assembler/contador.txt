LDI $0 ; INICIO DO SETUP
STA HEX0
STA HEX1
STA HEX2
STA HEX3
STA HEX4
STA HEX5
STA LEDR0-7
STA LEDR8
STA LEDR9
STA @0 ;UNIDADR
STA @1 ;DEZENA
STA @2 ;CENTENA
STA @3 ; VALOR 0
STA CLR-KEY0
STA CLR-KEY1
LDI $1
STA @4 ; VALOR 1

LDI $10
STA @5 ; VALOR 10

LDI $0
STA @6 ;FLAG MAXIMO

STA @8 ;LIMITE PARA UNIDADE
STA @9 ;LIMITE PARA DEZENA
STA @10 ;LIMITE PARA CENTENA
FIM-DO-SETUP

MAIN

JSR ESCREVE-HEX

JSR LIMITE-DE-CONTAGEM

LDA KEY0
ANDOP @4
CEQ @3
JEQ PASS-INCREMENTA
JSR INCREMENTA-VALOR
PASS-INCREMENTA

LDA KEY1
ANDOP @4
CEQ @3 
JEQ PASS-CONFIG
JSR CONFIG-LIMITE
PASS-CONFIG

LDA FPGA_RESET
ANDOP @4
CEQ @3
JEQ PASS-RENICIAR
JSR RENICIAR-CONT
PASS-RENICIAR

JMP MAIN


ESCREVE-HEX 
LDA @0
STA HEX0
NOP
LDA @1
STA HEX1
NOP
LDA @2
STA HEX2
RET


INCREMENTA-VALOR
STA CLR-KEY0
LDA @6
CEQ @4
JEQ VOLTA-VALOR

LDA @0  ; UNIDADE
SOMA @4 ; A+1
STA @0 ; UNIDADE
CEQ @5 ; A == 10
JEQ INC-TENS
NOP
RET

INC-TENS
LDI $0
STA @0 ;ZERA UNIDADE
LDA @1 ;DEZENA
SOMA @4 ; A+1
STA @1
CEQ @5 ; A == 10
JEQ INC-HUNDREDS
NOP
RET

INC-HUNDREDS
LDI $0
STA @1 ; ZERA DEZENA
LDA @2 ; CENTENA
SOMA @4 ; A+1
STA @2
CEQ @5 ; A == 10
JEQ ZERO
NOP
RET

ZERO
LDI $0
STA @2

LDI $1
STA LEDR9 ;LED OVERFLOW
STA @6


VOLTA-VALOR
RET


CONFIG-LIMITE
STA CLR-KEY1

LDI $1
STA LEDR8
STA LEDR9

DEFINE-UNIDADE
LDI $1
STA LEDR0-7
LDA SW0_7
STA @8

LDA KEY1 ;ESPERA CONFIRMAÇÃO DA RESPOSTAS
ANDOP @4
CEQ @3
JEQ DEFINE-UNIDADE

LDI $0 ;APAGA LED0
STA LEDR0-7
STA CLR-KEY1

DEFINE-DEZENA
LDI $2
STA LEDR0-7
LDA SW0_7
STA @9

LDA KEY1 ;ESPERA CONFIRMAÇÃO DA RESPOSTAS
ANDOP @4
CEQ @3
JEQ DEFINE-DEZENA

LDI $0 ;APAGA LED1
STA LEDR0-7
STA CLR-KEY1

DEFINE-CENTENA
LDI $4
STA LEDR0-7
LDA SW0_7
STA @10

LDA KEY1
ANDOP @4
CEQ @3
JEQ DEFINE-CENTENA

LDI $0
STA LEDR0-7
STA CLR-KEY1

STA LEDR8
STA LEDR9
JMP MAIN

LIMITE-DE-CONTAGEM

LDA @2
CEQ @10
JEQ PROX--DEZENA
RET

PROX--DEZENA
LDA @1
CEQ @9
JEQ PROX--UNIDADE
RET

PROX--UNIDADE
LDA @0
CEQ @8
JEQ PROX--NADA
RET

PROX--NADA
LDI $1
STA @6
STA LEDR8
RET

RENICIAR-CONT
STA CLR-FPGA-RESET
LDI $0
STA @0
STA @1
STA @2
STA @6
STA LEDR8
STA LEDR9
STA LEDR0-7
LDI $10
STA @5
RET